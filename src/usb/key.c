#include <stdint.h>
#include <memory.h>

#include "usb.h"

#define ep_out      (ep0buf + 64)
#define ep_in       (ep0buf + 128)

uint8_t HIDKey[8] = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0};

const uint8_t KeyRepDesc[] = {
	0x05, 0x01, 0x09, 0x06, 0xA1, 0x01, 0x05, 0x07, 0x19, 0xe0, 0x29, 0xe7, 0x15, 0x00, 0x25,
	0x01, 0x75, 0x01, 0x95, 0x08, 0x81, 0x02, 0x95, 0x01, 0x75, 0x08, 0x81, 0x01, 0x95, 0x03,
	0x75, 0x01, 0x05, 0x08, 0x19, 0x01, 0x29, 0x03, 0x91, 0x02, 0x95, 0x05, 0x75, 0x01, 0x91,
	0x01, 0x95, 0x06, 0x75, 0x08, 0x26, 0xff, 0x00, 0x05, 0x07, 0x19, 0x00, 0x29, 0x91, 0x81,
	0x00, 0xC0
};

const uint8_t KeyRepDesc_len = sizeof(KeyRepDesc);

void key_hidReport(uint8_t key)
{
	HIDKey[2] = key;
	memcpy(ep_in /*???*/, HIDKey, sizeof(HIDKey));
	usb_res_ack(4 /*???*/, sizeof(HIDKey));
}

void key_init()
{
	usb_dma_config(4, ep_out);
}

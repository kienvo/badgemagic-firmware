#include <stdint.h>
#include <memory.h>

#include "usb.h"

static __attribute__((aligned(4))) uint8_t ep_buf[64 + 64]; //ep2_out(64)+ep2_in(64)
uint8_t *const ep_out = ep_buf;
uint8_t *const ep_in = ep_buf + 64;

uint8_t HIDMouse[4] = {0x0, 0x0, 0x0, 0x0};

const uint8_t MouseRepDesc[] = {
	0x05, 0x01, 0x09, 0x02, 0xA1, 0x01, 0x09, 0x01, 0xA1, 0x00, 0x05, 0x09, 0x19, 0x01, 0x29,
	0x03, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x03, 0x81, 0x02, 0x75, 0x05, 0x95, 0x01,
	0x81, 0x01, 0x05, 0x01, 0x09, 0x30, 0x09, 0x31, 0x09, 0x38, 0x15, 0x81, 0x25, 0x7f, 0x75,
	0x08, 0x95, 0x03, 0x81, 0x06, 0xC0, 0xC0
};

const uint8_t MouseRepDesc_len = sizeof(MouseRepDesc);

void mouse_hidReport(uint8_t mouse)
{
	HIDMouse[0] = mouse;
	memcpy(ep_in, HIDMouse, sizeof(HIDMouse));
	usb_res_ack(2, sizeof(HIDMouse));
}

void mouse_init()
{
	usb_dma_config(2, ep_out);
}
